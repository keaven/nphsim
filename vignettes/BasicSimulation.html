<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Keaven Anderson and Yang Wang" />

<meta name="date" content="2017-05-31" />

<title>Basic Simulation with the nphsim R Package</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Basic Simulation with the nphsim R Package</h1>
<h4 class="author"><em>Keaven Anderson and Yang Wang</em></h4>
<h4 class="date"><em>2017-05-31</em></h4>



<p>We demonstrate the basic simulation capabilities for time-to-event clinical trials that are implemented in the <code>nphsim</code> package. This includes:</p>
<ul>
<li>Simulating enrollment with piecewise constant enrollment rates</li>
<li>Simulating times-to-events with a piecewise exponential distribution</li>
<li>Simulating a clinical trial (fixed design) by combining the above capabilities</li>
<li>Performing various statistical tests on a simulated clinical trial</li>
</ul>
<div id="simulating-enrollment" class="section level2">
<h2>Simulating Enrollment</h2>
<p>We use piecewise constant enrollment and piecewise exponential failure rates as methods to approximate arbitrary patterns of enrollment and dropouts. We specify an example non-proportional hazards scenario.</p>
<p>We approximate an arbitrary enrollment pattern by assuming constant enrollment rates within fixed time periods. The length of enrollment periods prior to the final stable enrollment (2, 4, respectively) are specified here; the final duration of 12 in the third period may be extended or shortened to achieve enrollment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">enrollIntervals &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)</code></pre></div>
<p>Thus, we assume enrollment is constant in months 1-2, 3-6, and from month 7 onward. Next we specify relative rates of enrollment in these time periods:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">enrollRates &lt;-<span class="st"> </span><span class="kw">c</span>(.<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">16</span>)</code></pre></div>
<p>Let’s say we wish to enroll 200 patients, starting with 7 patients per month and doubling after month 2 and month 6 as specified above.</p>
<p>We generate random enrollment times as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nphsim)
enrollTimes &lt;-<span class="st"> </span><span class="kw">rpwexp</span>(<span class="dt">n =</span> <span class="dv">300</span>, <span class="dt">rate =</span> <span class="dv">7</span> *<span class="st"> </span>enrollRates, <span class="dt">intervals =</span> enrollIntervals, <span class="dt">cumulative =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>When ’cumulative = TRUE<code>is input to</code>rpwexp<code>, it is designed to simulate enrollment with rates specified in</code>rate`.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">qplot</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span>, enrollTimes), <span class="dt">y =</span> <span class="dv">0</span>:<span class="kw">length</span>(enrollTimes), <span class="dt">geom=</span><span class="st">&quot;step&quot;</span>, 
      <span class="dt">ylab=</span><span class="st">&quot;Number enrolled&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Time&quot;</span>) +
<span class="st">      </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">6</span>,<span class="dv">12</span>,<span class="dv">18</span>))</code></pre></div>
<div class="figure">
<img src="data:image/png;base64,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" alt="Plot of simulated enrollment." />
<p class="caption">Plot of simulated enrollment.</p>
</div>
<p>You can see the enrollment rate increases from the first 2 months to months 3-6 and again in the period after month 6. The last patient in this simulation is enrolled at <code>max(enrollTimes) =</code> 8.1 months.</p>
</div>
<div id="generating-piecewise-exponential-failure-times" class="section level2">
<h2>Generating Piecewise Exponential Failure Times</h2>
<p>We can also use the <code>rpwexp</code> function to generate piecewise exponential failure times. We have a different set of intervals to define the periods of time for which different failure rates apply:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Failure rates for piecewise exponential time periods</span>
failRates &lt;-<span class="st"> </span><span class="kw">c</span>(.<span class="dv">3</span>, .<span class="dv">6</span>, .<span class="dv">5</span>)
<span class="co"># Interval duration(s) before final stable rate</span>
<span class="co"># Note that length is 1 fewer than for failRates</span>
<span class="co"># and should be NULL if there is only 1 failure rate</span>
failIntervals &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)</code></pre></div>
<p>Now we generate the piecewise exponential failure times corresponding to the patient enrollment previously simulated, again using <code>rpwexp</code>. We do not need to specify the default value <code>cumulative = FALSE</code> which distinguishes this from the call generating enrollment times.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="kw">length</span>(enrollTimes)
y &lt;-<span class="st"> </span><span class="kw">rpwexp</span>(<span class="dt">n =</span> n, <span class="dt">rate =</span> failRates, <span class="dt">intervals =</span> failIntervals)</code></pre></div>
<p>The longest duration among these is <code>max(y) =</code> 10.7. Although we will eventually be interested in generating censored survival times, this is not done here; there is a value for event time each simulated patient. We plot the duration of time until an event for all patients ordered by decreasing time which reproduces the shape of the Kaplan-Meier curve for the points; the <code>theme</code> function removes the y-axis as well as its labels and tick-marks. Note that at random there are some patients with very long simulated times.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">id &lt;-<span class="st"> </span><span class="dv">1</span>:n
<span class="co"># sort patient time-to-event and create a 0 starting point for each patient</span>
dta &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">N=</span><span class="kw">factor</span>(<span class="kw">c</span>(id,id)),<span class="dt">Time=</span><span class="kw">c</span>(<span class="kw">array</span>(<span class="dv">0</span>,n), <span class="kw">sort</span>(y, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)))
<span class="kw">ggplot</span>(dta, <span class="kw">aes</span>(<span class="dt">x =</span> Time, <span class="dt">y =</span> N, <span class="dt">grp =</span> N)) +<span class="st"> </span><span class="kw">geom_line</span>() +
<span class="st">       </span><span class="kw">xlab</span>(<span class="st">&quot;Time-to-event&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Patients ordered by time-to-event&quot;</span>) +
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span>(<span class="dv">0</span>:<span class="dv">4</span>)*<span class="dv">6</span>) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y=</span><span class="kw">element_blank</span>(),<span class="dt">axis.ticks.y=</span><span class="kw">element_blank</span>())</code></pre></div>
<div class="figure">
<img src="data:image/png;base64,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" alt="Plot of sorted simulated failure times without censoring." />
<p class="caption">Plot of sorted simulated failure times without censoring.</p>
</div>
</div>
<div id="simulating-a-2-arm-trial-instance-with-non-proportional-hazards" class="section level1">
<h1>Simulating a 2-Arm Trial Instance with Non-Proportional Hazards</h1>
<p>We now proceed to simulating a clinical trial with the control group rate specified above and with an experimental group having piecewise exponential rates generated according to a non-proportional hazards assumption. The parameters here appear somewhat different than above in <code>rpwexp</code> examples as they follow variable names used in the <code>gsDesign</code> R package. We make the sample size large so that the resulting estimated survival should approximate the underlying distributions closely.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Hazard ratio corresponding to control group event rates above</span>
hr &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, .<span class="dv">6</span>, .<span class="dv">3</span>)
<span class="co"># Sample size of control and experimental arms</span>
ssC &lt;-<span class="st"> </span><span class="dv">5000</span>
ssE &lt;-<span class="st"> </span><span class="dv">5000</span>
<span class="co"># We assume dropouts at a rate of .1 per time unit, increasing to .3 at end</span>
<span class="co"># dropout rates specified for same intervals as failure rates</span>
eta &lt;-<span class="st"> </span><span class="kw">c</span>(.<span class="dv">1</span>,.<span class="dv">1</span>,.<span class="dv">3</span>)
<span class="co"># Simulate a single trial instance</span>
<span class="co"># We add an arbitrary enrollment interval for indefinite enrollment duration</span>
trial &lt;-<span class="st"> </span><span class="kw">nphsim</span>(<span class="dt">nsim =</span> <span class="dv">1</span>, <span class="dt">lambdaC =</span> failRates, <span class="dt">lambdaE =</span> failRates*hr,
                <span class="dt">intervals =</span> failIntervals, <span class="dt">ssC =</span> ssC, <span class="dt">ssE =</span> ssE,
                <span class="dt">gamma =</span> <span class="dv">2</span> *<span class="st"> </span>enrollRates, <span class="dt">R =</span> enrollIntervals,
                <span class="dt">eta =</span> eta, <span class="dt">etaE =</span> eta)</code></pre></div>
<pre><code>## Warning in gamma * R: longer object length is not a multiple of shorter
## object length

## Warning in gamma * R: longer object length is not a multiple of shorter
## object length</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show a few lines</span>
<span class="kw">head</span>(trial$simd, <span class="dt">n=</span><span class="dv">5</span>)</code></pre></div>
<pre><code>##    sim treatment   enterT       ct   survival cnsr
## 1:   1   control 8.004464 8.462161 0.45769722    0
## 2:   1   control 6.995077 8.416111 1.42103427    0
## 3:   1   control 6.996907 7.508014 0.51110698    0
## 4:   1   control 2.976032 6.374969 3.39893718    0
## 5:   1   control 2.353300 2.369269 0.01596862    0</code></pre>
<p>In the above, we see the simulation ID in <code>sim</code>, treatment group in <code>treatment</code>, time of study entry in <code>enterT</code>, duration followed for survival in <code>survival</code> and censoring value (0 = event, 1 = censored) in <code>cnsr</code>. We examine censoring by treatment group:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(trial$simd$treatment, trial$simd$cnsr)</code></pre></div>
<pre><code>##             
##                 0    1
##   control    4072  928
##   experiment 3623 1377</code></pre>
<p>Summarizing times of events relative to start of enrollment, we have</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(trial$simd$enterT+trial$simd$survival)</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.2738  6.8180  8.0820  8.1120  9.4080 23.8400</code></pre>
<p>We compare the distributions of times to events by computing Kaplan-Meier curves. The curves appear to separate more as time goes on and the hazard ratio becomes more extreme. We would expect no separation over the first 2 where the hazard ratio is 1, with increasing separation over time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(survival)
<span class="kw">plot</span>(<span class="kw">with</span>(trial$simd, <span class="kw">survfit</span>(<span class="kw">Surv</span>(survival, <span class="dv">1</span>-cnsr) ~<span class="st"> </span>treatment)))</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="performing-an-analysis" class="section level1">
<h1>Performing an analysis</h1>
<p>Now suppose we wish to test after 900 events. First, we test with a logrank statistic:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">testOut &lt;-<span class="st"> </span><span class="kw">simtest</span>(<span class="dt">x =</span> trial, <span class="dt">anaD=</span><span class="dv">900</span>, <span class="dt">method=</span><span class="st">'LR'</span>)
testOut$result</code></pre></div>
<pre><code>##    sim analysis        t   NE  DE   NC  DC   D        pval         z
## 1:   1        1 5.072237 1169 432 1109 468 900 0.002583836 -2.796392
##           hr       sehr
## 1: 0.8297752 0.06682501</code></pre>
<p>Now we test at the same time, this time using a Harrington-Fleming test with <span class="math inline">\(\rho=0\)</span>, <span class="math inline">\(\gamma=1\)</span> and <span class="math inline">\(\rho=1\)</span>, <span class="math inline">\(\gamma=1\)</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(survMisc) <span class="co"># needed for weighted logrank</span></code></pre></div>
<pre><code>## 
## Attaching package: 'survMisc'</code></pre>
<pre><code>## The following object is masked from 'package:ggplot2':
## 
##     autoplot</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">testOut &lt;-<span class="st"> </span><span class="kw">simtest</span>(<span class="dt">x =</span> trial, <span class="dt">anaD=</span><span class="dv">900</span>, <span class="dt">method=</span>wlr.Stat, <span class="dt">fparam=</span><span class="kw">list</span>(<span class="dt">rho=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">gamma=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">wlr=</span><span class="st">'FH(0,1)'</span>, <span class="dt">APPLE=</span><span class="dv">1</span>))
testOut$result</code></pre></div>
<pre><code>##    sim analysis        t   NE  DE   NC  DC   D        pval      pval_1
## 1:   1        1 5.072237 1169 432 1109 468 900 3.01011e-07 0.002583836
##          pval_n pval_sqrtN   pval_S1   pval_S2 pval_APPLE pval_FH(0,1)
## 1: 0.0002747533 0.00072442 0.3528745 0.3524709   0.414203  3.01011e-07
##    pval_FH(1,1)
## 1: 0.0002854579</code></pre>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
